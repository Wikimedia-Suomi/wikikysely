{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ survey.title }}{% endblock %}
{% block content %}
{% if survey.state == 'paused' %}
  <div class="alert alert-info">{% translate 'This survey is currently paused.' %}</div>
{% endif %}
{% if not questions %}
  <p class="alert alert-warning">{% translate 'This survey has no questions yet. Please add questions.' %}</p>
{% endif %}
{% if not request.user.is_authenticated and questions %}
  {% if request.GET.login_required %}
    <p class="alert alert-info">
      {% translate 'You must be logged in to answer questions' %}.
      <a href="{% url 'login' %}?next={{ request.path }}">{% translate 'Login' %}</a>
    </p>
  {% endif %}
{% endif %}
<p>{{ survey.description }}</p>
{% if request.user.is_authenticated %}
  <div class="mb-3">
    {% if unanswered_questions and survey.state == 'running' %}
      <a href="{% url 'survey:answer_survey' %}" class="btn btn-primary">{% translate 'Answer survey' %}</a>
    {% endif %}
    {% if questions %}
      <a href="{% url 'survey:survey_results' %}" class="btn btn-info">{% translate 'Results' %}</a>
    {% endif %}
    {% if can_edit %}
      <a href="{% url 'survey:survey_edit' %}" class="btn btn-warning">{% translate 'Edit survey' %}</a>
    {% endif %}
  </div>
{% else %}
    {% if questions %}
        <a href="?login_required=1" class="btn btn-primary">{% translate 'Answer survey' %}</a>
    {% endif %}
{% endif %}
    {% if unanswered_questions %}
        <h2 class="mt-3">{% translate 'Unanswered questions' %}</h2>
      <table class="table mb-3">
        <thead>
          <tr>
            <th>{% translate 'Title' %}</th>
            <th>{% translate 'Published' %}</th>
            <th>{% translate 'Answers' %}</th>
            <th>{% translate 'Agree' %}</th>
          </tr>
        </thead>
        <tbody>
        {% for q in unanswered_questions %}
          <tr>
{% if request.user.is_authenticated %}
            <td><a href="{% url 'survey:answer_question' q.pk %}">{{ q.text }}</a></td>
{% else %}
            <td>{{ q.text }}</td>
{% endif %}
            <td>{{ q.created_at | date:"Y-m-d" }}</td>
            <td>{{ q.total_answers }}</td>
            <td>{% widthratio q.yes_count q.total_answers 100 %}%</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% endif %}

{% if user_answers %}
<h2 class="mt-4">{% translate 'My answers' %}</h2>
<ul class="list-group mb-3">
  {% for a in user_answers %}
  <li class="list-group-item">
    <div class="d-flex justify-content-between">
      <div>
        <a href="{% url 'survey:answer_question' a.question.pk %}"><strong>{{ a.question.text }}</strong></a>
        <span class="badge bg-secondary ms-2">{{ a.get_answer_display }}</span>
      </div>
      {% if survey.state == 'running' %}
      <div>
        <a href="{% url 'survey:answer_question' a.question.pk %}" class="btn btn-sm btn-warning me-2">{% translate 'Edit' %}</a>
        <a href="{% url 'survey:answer_delete' a.pk %}" class="btn btn-sm btn-danger">{% translate 'Remove answer' %}</a>
      </div>
      {% endif %}
    </div>
    <small class="text-muted">
      {% translate 'Published' %}: {{ a.question.created_at|date:"Y-m-d" }} |
      {% translate 'Answers' %}: {{ a.total_answers }} |
      {% translate 'Agree' %}: {% widthratio a.yes_count a.total_answers 100 %}%
    </small>
  </li>
  {% endfor %}
</ul>
{% endif %}

{% endblock %}
