{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{{ survey.title }}{% endblock %}
{% block content %}
{% if survey.state == 'paused' %}
  <div class="alert alert-info">{% translate 'This survey is currently paused.' %}</div>
{% endif %}
{% if not request.user.is_authenticated %}
  {% if request.GET.login_required %}
    <p class="alert alert-info">
      {% translate 'You must be logged in to answer questions' %}.
      {% if local_login_enabled %}
      <a href="{% url 'login' %}?next={% url 'login_redirect' %}">{% translate 'Login' %}</a>
      {% else %}
      <a href="{% url 'social:begin' 'mediawiki' %}?next={% url 'login_redirect' %}">{% translate 'Login with Wikimedia' %}</a>
      {% endif %}
    </p>
  {% endif %}
{% endif %}
<p>{{ survey.description }}</p>
{% if request.user.is_authenticated %}
  <div class="mb-3">
    <a href="{% url 'survey:answer_survey' %}" class="btn btn-primary" id="answer-survey-btn" style="display:none">{% translate 'Answer survey' %}</a>
    <a href="{% url 'survey:survey_answers' %}" class="btn btn-info" id="survey-answers-btn" style="display:none">{% translate 'Answers' %}</a>
    <a href="{% url 'survey:question_add' %}" class="btn btn-secondary">{% translate 'Add question' %}</a>
  </div>
{% else %}
    <a href="?login_required=1" class="btn btn-primary" id="answer-survey-btn" style="display:none">{% translate 'Answer survey' %}</a>
{% endif %}

<h2 id="unanswered-header" class="mt-3" style="display:none">{% translate 'Unanswered questions' %}</h2>
<div class="table-responsive">
  <table id="unanswered-table" class="table mb-3 survey-detail-table stacked-table" style="display:none">
    <thead>
      <tr>
        <th>{% translate 'Published' %}</th>
        <th>{% translate 'Title' %}</th>
        <th>{% translate 'Answers' %}</th>
        <th>{% translate 'Agree' %}</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<h2 id="my-answers-header" class="mt-4" style="display:none">{% translate 'My answers' %}</h2>
<div class="table-responsive">
  <table id="my-answers-table" class="table mb-3 survey-detail-table stacked-table" style="display:none">
    <thead>
      <tr>
        <th>{% translate 'Published' %}</th>
        <th>{% translate 'Title' %}</th>
        <th>{% translate 'Answers' %}</th>
        <th>{% translate 'Agree' %}</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
{% if can_edit %}
   <a href="{% url 'survey:survey_edit' %}" class="btn btn-warning ms-2">{% translate 'Edit survey' %}</a>
{% endif %}

{% endblock %}
{% block scripts %}
<script>
var QUESTIONS_API_URL = "{% url 'survey:questions_api' %}";
var IS_AUTHENTICATED = {% if request.user.is_authenticated %}true{% else %}false{% endif %};
var SURVEY_STATE = "{{ survey.state }}";
var LABEL_PUBLISHED = "{% translate 'Published' %}";
var LABEL_TITLE = "{% translate 'Title' %}";
var LABEL_ANSWERS = "{% translate 'Answers' %}";
var LABEL_AGREE = "{% translate 'Agree' %}";
var LABEL_YES = "{% translate 'Yes' %}";
var LABEL_NO = "{% translate 'No' %}";
var LABEL_EDIT = "{% translate 'Edit' %}";
var LABEL_REMOVE_QUESTION = "{% translate 'Remove question' %}";
var LABEL_REMOVE_ANSWER = "{% translate 'Remove answer' %}";
var LABEL_ANSWER = "{% translate 'Answer' %}";
</script>
<script src="{% static 'js/sort_tables.js' %}"></script>
<script src="{% static 'js/survey_detail_ajax.js' %}"></script>
{% endblock %}
