{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{{ request.user.username }}{% endblock %}
{% block content %}
<h2>{% translate 'My data' %}</h2>
<dl class="user-data">
  <div>
    <dt>{% translate 'Username' %}</dt>
    <dd>{{ request.user.username }}</dd>
  </div>
  <div>
    <dt>{% translate 'Date joined' %}</dt>
    <dd>{{ request.user.date_joined|date:'Y-m-d' }}</dd>
  </div>
  <div>
    <dt>{% translate 'Questions' %}</dt>
    <dd>{{ total_questions }}</dd>
  </div>
  <div>
    <dt>{% translate 'Answers' %}</dt>
    <dd>{{ total_answers }}</dd>
  </div>
</dl>
<p>
  <form method="post" action="{% url 'survey:user_data_delete' %}" class="d-inline" onsubmit="return confirm('{% translate 'Deleting your data will remove all answers and all questions you have asked that do not yet have answers from other users and are not hidden. If you no longer have any questions or answers, your account will also be deleted. This action cannot be undone. Delete your data?' %}');">
    {% csrf_token %}
    <a href="{% url 'survey:userinfo_download' %}" class="btn btn-primary">{% translate 'Download my data (JSON)' %}</a>
    <button type="submit" class="btn btn-danger ms-2">{% translate 'Delete my data' %}</button>
  </form>

</p>

<h2 class="mt-4">{% translate 'My questions' %}</h2>
<div class="table-responsive mb-4">
<table class="table mb-0 stacked-table">
  <thead>
    <tr>
      <th>{% translate 'ID' %}</th>
      <th>{% translate 'Question' %}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for question in questions %}
    <tr>
      <td data-label="{% translate 'ID' %}">{{ question.pk }}</td>
      <td data-label="{% translate 'Question' %}">
        {% if question.visible %}
          {{ question.text }}
        {% else %}
          <span class="text-decoration-line-through">{{ question.text }}</span>
        {% endif %}
      </td>
      <td class="text-end" data-label="">
        {% if question.pk in editable_questions %}
        <a href="{% url 'survey:question_edit' question.pk %}" class="btn btn-sm btn-warning me-2">{% translate 'Edit' %}</a>
        {% endif %}
        {% if question.pk in hard_deletable_questions %}
        <a href="{% url 'survey:question_delete' question.pk %}" class="btn btn-sm btn-danger">{% translate 'Remove question' %}</a>
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="2">{% translate 'No questions' %}</td></tr>
  {% endfor %}
  </tbody>
</table>
</div>

<h2>{% translate 'My answers' %}</h2>
<div class="table-responsive">
<table class="table mb-0 stacked-table">
<thead>
  <tr>
    <th>{% translate 'ID' %}</th>
    <th>{% translate 'Question' %}</th>
    <th>{% translate 'Answer' %}</th>
    <th>{% translate 'Answers' %}</th>
    <th>{% translate 'Agree' %}</th>
    <th></th>
  </tr>
</thead>
<tbody>
{% for answer in answers %}
  <tr>
    <td data-label="{% translate 'ID' %}">{{ answer.question.pk }}</td>
    <td data-label="{% translate 'Question' %}">
      {% if answer.question.survey.state == 'running' %}
        <a href="{% url 'survey:answer_question' answer.question.pk %}?next={{ request.get_full_path|urlencode }}">{{ answer.question.text }}</a>
      {% else %}
        {{ answer.question.text }}
      {% endif %}
    </td>
    <td data-label="{% translate 'Answer' %}">{{ answer.get_answer_display }}</td>
    <td data-label="{% translate 'Answers' %}">{{ answer.total_answers }}</td>
    <td data-label="{% translate 'Agree' %}">{{ answer.agree_ratio|floatformat:1 }}%</td>
    <td class="text-end" data-label="">
      {% if answer.question.survey.state == 'running' %}
      <a href="{% url 'survey:answer_delete' answer.pk %}" class="btn btn-sm btn-danger ms-2 ajax-delete-answer" data-no-reload="true">{% translate 'Remove answer' %}</a>
      {% endif %}
    </td>
  </tr>
{% empty %}
  <tr><td colspan="6">{% translate 'No answers' %}</td></tr>
{% endfor %}
</tbody>
</table>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/survey_detail_ajax.js' %}"></script>
{% endblock %}
