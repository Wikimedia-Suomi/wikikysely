{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% if is_edit %}{% translate 'Edit survey' %}{% else %}{% translate 'Create survey' %}{% endif %}{% endblock %}
{% block content %}
<h1>{% if is_edit %}{% translate 'Edit survey' %}{% else %}{% translate 'Create survey' %}{% endif %}</h1>
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit" class="btn btn-primary me-2">{% translate 'Save' %}</button>
  {% if is_edit %}
  <a href="{% url 'survey:survey_detail' %}" class="btn btn-secondary">{% translate 'Cancel' %}</a>
  {% endif %}
</form>
{% if is_edit %}
  <h2 class="mt-4">{% translate 'Secretaries' %}</h2>
  <ul class="list-group mb-3">
    {% for u in secretaries %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ u.username }}</span>
        <a href="{% url 'survey:secretary_remove' u.pk %}" class="btn btn-sm btn-danger">{% translate 'Remove' %}</a>
      </li>
    {% empty %}
      <li class="list-group-item">{% translate 'No secretaries' %}</li>
    {% endfor %}
  </ul>
  <form method="post" action="{% url 'survey:secretary_add' %}" class="d-flex mb-4">
    {% csrf_token %}
    {{ secretary_form.username }}
    <button type="submit" class="btn btn-secondary ms-2">{% translate 'Add secretary' %}</button>
  </form>
  <h2 class="mt-4">{% translate 'Questions' %}</h2>
  <ul class="list-group mb-3">
    {% for q in active_questions %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ q.text }}</span>
        {% if survey.state != 'closed' %}
        <a href="{% url 'survey:question_hide' q.pk %}" class="btn btn-sm btn-danger">{% translate 'Hide' %}</a>
        {% endif %}
      </li>
    {% empty %}
      <li class="list-group-item">{% translate 'No questions' %}</li>
    {% endfor %}
  </ul>
  {% if hidden_questions %}
    <h3>{% translate 'Hidden questions' %}</h3>
    <ul class="list-group">
      {% for q in hidden_questions %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span class="text-muted">{{ q.text }}</span>
          {% if survey.state != 'closed' %}
          <a href="{% url 'survey:question_show' q.pk %}" class="btn btn-sm btn-secondary">{% translate 'Show' %}</a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
  <h2 class="mt-4">{% translate 'Survey log' %}</h2>
  <ul class="list-group">
    {% for log in logs %}
      <li class="list-group-item">
        {{ log.created_at|date:"Y-m-d H:i" }} - {{ log.data.username }} - {{ log.data.action }}{% if log.data.secretary_username %} - {{ log.data.secretary_username }}{% endif %}{% if log.data.question_text %} - {{ log.data.question_text }}{% endif %}
      </li>
    {% empty %}
      <li class="list-group-item">{% translate 'No log entries' %}</li>
    {% endfor %}
  </ul>
{% endif %}
{% endblock %}
