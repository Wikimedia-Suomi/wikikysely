{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ survey.title }}{% endblock %}
{% block content %}
<h1>{{ survey.title }} - {% translate 'Results' %}</h1>
<canvas id="resultsChart"></canvas>
<p class="mt-3">{% translate 'Total respondents' %}: {{ total_users }}</p>
<table class="table">
<thead><tr><th>{% translate 'Question' %}</th><th>{% translate 'Yes' %}</th><th>{% translate 'No' %}</th><th>{% translate 'Total' %}</th></tr></thead>
<tbody>
{% for row in data %}
<tr><td>{{ row.question.text }}</td><td>{{ row.yes }}</td><td>{{ row.no }}</td><td>{{ row.total }}</td></tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
{% block scripts %}
<script>
const data = {
    labels: [{% for row in data %}'{{ row.question.text|escapejs }}',{% endfor %}],
    datasets: [
        {label: gettext('Yes'), data: [{% for row in data %}{{ row.yes }},{% endfor %}], backgroundColor: 'green'},
        {label: gettext('No'), data: [{% for row in data %}{{ row.no }},{% endfor %}], backgroundColor: 'red'}
    ]
};
new Chart(document.getElementById('resultsChart'), {
    type: 'bar',
    data: data,
    options: {
        responsive: true,
        indexAxis: 'y',
        scales: {
            x: { stacked: true, max: {{ total_users }} },
            y: { stacked: true }
        },
        plugins: {
            legend: { display: true }
        }
    }
});
</script>
{% endblock %}
