{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{% translate 'Answers' %}{% endblock %}
{% block content %}
<div id="survey-answers-app"
     data-json-url="{% url 'survey:questions_json' %}"
     data-page-url="{% url 'survey:survey_answers' %}"
     data-wikitext-url="{% url 'survey:survey_answers_wikitext' %}"
     data-answer-url-template="{% url 'survey:answer_question' 0 %}"
     data-auth="{{ request.user.is_authenticated|yesno:'true,false' }}">
  <div v-if="loading">{% translate 'Loading...' %}</div>
  <template v-else>
    <h1>{% translate 'Answers' %}</h1>
    <p class="mt-3">{% translate 'Total respondents' %}: [[ totalUsers ]]</p>
    <h2>{% translate 'Answer table' %}</h2>
    <div class="table-responsive">
      <table id="answerTable" class="table stacked-table">
        <thead>
        <tr>
          <th>{% translate 'Published' %}</th>
          <th>{% translate 'Question' %}</th>
          <th v-if="auth">{% translate 'My answer' %}</th>
          <th>{% translate 'Yes' %}</th>
          <th>{% translate 'No' %}</th>
          <th>{% translate 'Total' %}</th>
          <th>{% translate 'Agree' %}</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="row in rows" :key="row.id">
          <td data-label="{% translate 'Published' %}">[[ row.published.slice(0,10) ]]</td>
          <td data-label="{% translate 'Question' %}">
            <a v-if="auth" :href="answerUrl(row.id)">[[ row.text ]]</a>
            <span v-else>[[ row.text ]]</span>
          </td>
          <td v-if="auth" data-label="{% translate 'My answer' %}">[[ row.my_answer || '' ]]</td>
          <td data-label="{% translate 'Yes' %}">[[ row.yes ]]</td>
          <td data-label="{% translate 'No' %}">[[ row.no ]]</td>
          <td data-label="{% translate 'Total' %}">[[ row.total ]]</td>
          <td data-label="{% translate 'Agree' %}">[[ row.agree_ratio.toFixed(1) ]]%</td>
        </tr>
        </tbody>
      </table>
    </div>
  </template>
</div>
{% endblock %}
{% block scripts %}
<script src="{% static 'js/sort_tables.js' %}"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="{% static 'js/survey_answers_vue.js' %}"></script>
{% endblock %}

